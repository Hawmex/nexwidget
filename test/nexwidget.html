<html>
  <body>
    <span>
      Seconds passed since I was first rendered:
      <test-element time-counter="0"></test-element>
    </span>

    <script type="module">
      import { runTests } from '@web/test-runner-mocha';
      import { expect } from '@esm-bundle/chai';
      import { Nexwidget, css, html } from '../src/nexwidget.js';

      runTests(async () =>
        it('creates web components', () => {
          class TestElement extends Nexwidget {
            static get styles() {
              return [
                ...super.styles,
                css`
                  :host {
                    background: red;
                    color: white;
                    display: block;
                    padding: 8px;
                    margin: 8px;
                  }
                `,
              ];
            }

            mountedCallback() {
              super.mountedCallback();
              setInterval(() => (this.timeCounter += 1), 1000);
            }

            get template() {
              return html`<h1>${this.testAttr}</h1>`;
            }

            get mountAnimation() {
              return [
                [
                  { transform: 'scale(0)', opacity: '0' },
                  { transform: 'scale(1)', opacity: '1' },
                ],
                { duration: 250, fill: 'forwards' },
              ];
            }

            get updateOrSlotChangeAnimation() {
              return [
                [
                  { transform: 'rotateX(-90deg)', opacity: '0' },
                  { transform: 'rotateX(0deg)', opacity: '1' },
                ],
                { duration: 250, fill: 'forwards' },
              ];
            }
          }

          TestElement.createAttributes({ timeCounter: Number });
          TestElement.createReactives(['timeCounter']);
          TestElement.register();

          requestAnimationFrame(() => {
            const element = document.querySelector('test-element');
            const span = document.querySelector('span');

            expect(getComputedStyle(element).getPropertyValue('background-color')).to.equal(
              'rgb(255, 0, 0)',
            );

            expect(element.timeCounter).to.equal(0);
            expect(element.getAttribute('time-counter')).to.equal('0');

            requestAnimationFrame(() =>
              expect(span.textContent).to.equal('Seconds passed since I was first rendered:0'),
            );

            setTimeout(() => {
              expect(element.timeCounter).to.equal(1);
              expect(element.getAttribute('time-counter')).to.equal('1');

              requestAnimationFrame(() =>
                expect(span.textContent).to.equal('Seconds passed since I was first rendered:1'),
              );
            }, 1000);

            setTimeout(() => {
              expect(element.timeCounter).to.equal(2);
              expect(element.getAttribute('time-counter')).to.equal('2');

              requestAnimationFrame(() =>
                expect(span.textContent).to.equal('Seconds passed since I was first rendered:2'),
              );
            }, 2000);
          });
        }),
      );
    </script>
  </body>
</html>
